<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Mobile FPS P2P</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
html,body{margin:0;padding:0;overflow:hidden;background:#000}
#ui{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none}
button,input{pointer-events:auto}

#centerDot{
  position:fixed;
  top:50%;left:50%;
  width:6px;height:6px;
  background:white;
  border-radius:50%;
  transform:translate(-50%,-50%);
}

#room{
  position:fixed;
  top:10px;left:50%;
  transform:translateX(-50%);
}

#shoot{
  position:fixed;
  top:60px;left:10px;
  width:70px;height:70px;
  border-radius:50%;
  background:red;
  color:white;
  font-size:16px;
}

.player{
  position:absolute;
  width:30px;height:30px;
  background:lime;
}
</style>
</head>

<body>
<div id="ui">
  <div id="room">
    <input id="roomId" placeholder="ODA KODU">
    <button onclick="join()">Katıl</button>
    <button onclick="host()">Oda Kur</button>
  </div>

  <button id="shoot">ATEŞ</button>
  <div id="centerDot"></div>
</div>

<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

<script>
let peer;
let conns = [];
let myId = "";
let x=200,y=200;
let players = {};

function host(){
  peer = new Peer();
  peer.on("open", id=>{
    alert("ODA KODU: "+id);
  });

  peer.on("connection", conn=>{
    conns.push(conn);
    conn.on("data", d=>{
      players[conn.peer]=d;
    });
  });

  start();
}

function join(){
  const id=document.getElementById("roomId").value;
  peer = new Peer();
  peer.on("open", my=>{
    const conn=peer.connect(id);
    conns.push(conn);
    conn.on("data", d=>{
      players[conn.peer]=d;
    });
  });
  start();
}

function start(){
  setInterval(()=>{
    for(const c of conns){
      c.send({x,y});
    }
    render();
  },50);
}

function render(){
  document.querySelectorAll(".player").forEach(p=>p.remove());
  for(const id in players){
    const d=document.createElement("div");
    d.className="player";
    d.style.left=players[id].x+"px";
    d.style.top=players[id].y+"px";
    document.body.appendChild(d);
  }
}

document.addEventListener("touchmove",e=>{
  x+=e.touches[0].movementX||0;
  y+=e.touches[0].movementY||0;
});
</script>
</body>
</html>
